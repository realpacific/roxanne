{% extends "index.html" %}
{{ super() }}
{% block content %}
<div class="row">
    <div class="col-3">
        <div class="card border-primary mb-3">
            <div class="card-header">Search</div>
            <div class="card-body">
                <form>
                    <fieldset>
                        <div class="form-group">
                            <label class="form-label mt-2">Channel Link</label>
                            <input class="form-control" type="text" id="channelLinkField"
                                   placeholder="https://t.me/merosharekhabargroup"
                                   value="https://t.me/merosharekhabargroup">
                        </div>
                        <div class="form-group">
                            <label class="form-label mt-2">By</label>
                            <input class="form-control" type="text" id="byField" placeholder="Prashant">
                        </div>
                        <div class="form-group">
                            <label class="form-label mt-2">Keywords</label>
                            <input class="form-control" type="text" id="keywordsField" placeholder="dogs,cats">
                        </div>

                        <div class="field-group">
                            <label class="form-label mt-2">Limit</label>
                            <input class="form-control" id="limitField" type="number" placeholder="10">
                        </div>

                        <div class="d-grid mt-2">
                            <button class="btn btn-lg btn-primary" type="button" id="btnGo">Go!</button>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>

    <div class="col-9">
        <div style="max-height: 90vh; overflow-y: scroll">
            {% for msg in messages %}
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">Prashant</h4>
                    <h6 class="card-subtitle mb-2 text-muted">1d ago</h6>
                    <p class="card-text">{{msg}}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}

{% block jsscripts %}
<script>
    function buildQuery(url, queryObj) {
        const addQueryIfNotEmpty = (_url, key, value) => {
            if (!_url.includes('&') && !_url.includes('?')) {
                _url = _url + '?';
            }
            const query = (value.trim().length > 0) ? `&${key}=${value}` : '';
            if (query) {
                return _url + query;
            }
            return _url
        };
        let newUrl = url;
        for (let key of Object.keys(queryObj)) {
            newUrl = addQueryIfNotEmpty(newUrl, key, queryObj[key]);
        }
        return newUrl.replace('?&', '?');
    }

    $('#btnGo').click((e) => {
        e.preventDefault()
        const query = {
            channel_link: $('#channelLinkField').val(),
            search: '',
            filter: $('#keywordsField').val(),
            limit: $('#limitField').val(),
            by_user: $('#byField').val(),
        }
        window.location.href = buildQuery('', query);
    })
</script>
{% endblock %}
