{% extends "index.html" %}
{{ super() }}
{% block content %}
<div style="max-height: 90vh; overflow-y: scroll">
    {% for msg in messages %}
    <div class="card">
        <div class="card-body">
            <h6 class="card-title">{{msg.author_name}}</h6>
            <h6 class="card-subtitle mb-2 text-muted">{{msg.time}}</h6>
            <p class="card-text">{{msg.full_message}}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block jsscripts %}
<script>
    function buildQuery(url, queryObj) {
        const addQueryIfNotEmpty = (_url, key, value) => {
            if (!_url.includes('&') && !_url.includes('?')) {
                _url = _url + '?';
            }
            const query = (value.trim().length > 0) ? `&${key}=${value}` : '';
            if (query) {
                return _url + query;
            }
            return _url
        };
        let newUrl = url;
        for (let key of Object.keys(queryObj)) {
            newUrl = addQueryIfNotEmpty(newUrl, key, queryObj[key]);
        }
        return newUrl.replace('?&', '?');
    }

    $('#btnGo').click((e) => {
        e.preventDefault()
        const query = {
            channel_link: $('#channelLinkField').val(),
            search: $('#keywordsField').val(),
            filter: '',
            limit: $('#limitField').val(),
            by_user: $('#byField').val(),
        }
        window.location.href = buildQuery('', query);
    })
</script>
{% endblock %}
